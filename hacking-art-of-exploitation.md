# Notas sobre hacking the art of exploitation - Segunda edicion

## Utilidades
Muchas utilidades para linux tambien se pueden instalar en mac usando herramientas como ports o homebrew y los comandos para invocar las utilidades son los mismos con la diferencia de que muchos de ellos **se preceden por una letra g**. 

*Ejemplo: Para el comando `gdb` en Linux, en MacOS lo instalo con el comando `sudo port install gdb` y luego lo puedo utilizar con `ggdb`
Lo mismo se aplica para `objdump`, se llama con `gobjdump`*

### Disassembler
    objdump -D EJECUTABLE
#### Parametros:
    -M intel //sintaxis intel en lugar de AT&T por defecto

#### MacOS
    otool -tV // ya viene con xcode tools en mac

### Debugger
	gdb
Es complicado hacer funcionar gdb en MacOS El capitan, hice todo los pasos pero sigue sin funcionar: 
<http://stackoverflow.com/questions/33162757/how-to-install-gdb-debugger-in-mac-osx-el-capitan>
#### MacOS
	lldb // usa diferentes comandos a gdb

### GDB
Para debuggear a bajo nivel un programa compilado en C
	
	gdb -q ./a.out // -q quiet, evita que se imprima el texto de licencia, etc
	break main
	run


#### Analizar registros
Se puede ver la informacion de los registros del cpu u opcionalmente de uno solo en particular.
Se puede abreviar `info` solo con `i` y `registers` con `r`:

`i[nfo] r[egisters] [name]`

#### Sintax
Setear la sintaxis de desamblaje a intel.

	set (disassembly-flavor|dissasembly|dis) intel
		
#### .gdbinit

Para setear configuraciones permanentes se puede crear/modificar el archivo `~/.gdbinit` incluyendo los comandos

#### Si el ejecutable fue compilado con gcc -g:
	list 			 // muestra el codigo fuente del ejecutable 
	dissasemble main // desensambla solo el main

#### Examinar direcciones de memoria
	x[p] DIR    // Examina direcciones de memoria con [p]arametros opcionales
	x 0x400535	// Examina la direccion 0x400535
	x $eip 		// Examina la direccion guardada en el registro EIP

Se puede hacer uso de **aritmetica** al indicar la dirección a examinar: `x $ebp - 4`

Los parámetros de `x` son `x/AFB` donde:

	A = # 	    // Cantidad de unidades a examinar
	F = [oxuti..] 	// Formato: octal, hexa, unsigned, binario o instrucción (hay otros)
	B = [bhwg] // se puede especificar tambien el tamaño de lo que examina:
			   // 1|2|4|8 bytes - byte|halfword|word|giant


**Notar:** Como la arquitectura x86 es little endian hacer `x/2xb $eip` muestra: **`0xc7 0x45`** y `x/xw $eip` muestra: **`0x45c7`** (estan *"dados vuelta"*) lo cual tiene sentido.

#### Avanzar IP
Leer la siguiente instruccion en IP, ejecutarla, y avanzar el IP a la siguiente instrucción:

	nexti

#### Conversion a string y character

	x/cb
	Con la c puedo indicar que quiero que lo muestre como caracter

	x/s
	Con la s puedo indicar que quiero que lo muestre como un string

##### Extra: Utilidad basic calculator

	bc -ql
	123+123...

##### Extra: Utilidad para ver tabla ascii (en terminal, fuera de gdb)

	man ascii

Tabla ascii (para investigar la memoria con datos que son letras, numeros, etc)

#### Backtrace

	bt

Backtrace, hace un "rastreo" hacia atras, en el stack, mirando las direcciones de retorno que hay apiladas para saber desde donde viene la ejecucion actual del programa (cada invocacion a una funcion apila en el stack la direccion de retorno).

	cont

Se escribe `cont` luego de un `bt` para continuar con el debuging.

#### Comando print

Se puede usar para imprimir valores y guarda el resultado en la variable `$1`

	print $ebp - 4 // el resultado queda en $1
	x $1		   // se examina la dirección $1

> Creditos a: Jon Erickson. "Hacking: The Art of Exploitation, 2nd Edition."
